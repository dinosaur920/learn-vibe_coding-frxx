import{s as mt,a as pt,u as nt,b as P,c as $t}from"./BskD4ZCU.js";import{w as _t,s as yt}from"./DSmQk4JK.js";import{d as gt,J as Mt,r as E,k as wt,o as St,e as bt,x as M,y as $,z as c,B as at,K as dt,L as ft,C as G,M as rt,A as B,N as K,O as ht,P as it,D as ot,_ as Dt}from"./C57q5Bld.js";import{C as kt,B as Ot,g as It,H as ut,u as Ct}from"./B8Rp0WmU.js";function xt(T){return T&&T.__esModule&&Object.prototype.hasOwnProperty.call(T,"default")?T.default:T}var X={exports:{}},Tt=X.exports,vt;function Ht(){return vt||(vt=1,(function(T,lt){(function(j,C){T.exports=C()})(Tt,(function(){var j=1e3,C=6e4,x=36e5,H="millisecond",k="second",O="minute",I="hour",w="day",U="week",y="month",R="quarter",S="year",L="date",J="Invalid Date",tt=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,et=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,st={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(r){var s=["th","st","nd","rd"],t=r%100;return"["+r+(s[(t-20)%10]||s[t]||s[0])+"]"}},z=function(r,s,t){var n=String(r);return!n||n.length>=s?r:""+Array(s+1-n.length).join(t)+r},h={s:z,z:function(r){var s=-r.utcOffset(),t=Math.abs(s),n=Math.floor(t/60),e=t%60;return(s<=0?"+":"-")+z(n,2,"0")+":"+z(e,2,"0")},m:function r(s,t){if(s.date()<t.date())return-r(t,s);var n=12*(t.year()-s.year())+(t.month()-s.month()),e=s.clone().add(n,y),i=t-e<0,o=s.clone().add(n+(i?-1:1),y);return+(-(n+(t-e)/(i?e-o:o-e))||0)},a:function(r){return r<0?Math.ceil(r)||0:Math.floor(r)},p:function(r){return{M:y,y:S,w:U,d:w,D:L,h:I,m:O,s:k,ms:H,Q:R}[r]||String(r||"").toLowerCase().replace(/s$/,"")},u:function(r){return r===void 0}},a="en",d={};d[a]=st;var b="$isDayjsObject",F=function(r){return r instanceof q||!(!r||!r[b])},u=function r(s,t,n){var e;if(!s)return a;if(typeof s=="string"){var i=s.toLowerCase();d[i]&&(e=i),t&&(d[i]=t,e=i);var o=s.split("-");if(!e&&o.length>1)return r(o[0])}else{var f=s.name;d[f]=s,e=f}return!n&&e&&(a=e),e||!n&&a},v=function(r,s){if(F(r))return r.clone();var t=typeof s=="object"?s:{};return t.date=r,t.args=arguments,new q(t)},l=h;l.l=u,l.i=F,l.w=function(r,s){return v(r,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var q=(function(){function r(t){this.$L=u(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[b]=!0}var s=r.prototype;return s.parse=function(t){this.$d=(function(n){var e=n.date,i=n.utc;if(e===null)return new Date(NaN);if(l.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){var o=e.match(tt);if(o){var f=o[2]-1||0,m=(o[7]||"0").substring(0,3);return i?new Date(Date.UTC(o[1],f,o[3]||1,o[4]||0,o[5]||0,o[6]||0,m)):new Date(o[1],f,o[3]||1,o[4]||0,o[5]||0,o[6]||0,m)}}return new Date(e)})(t),this.init()},s.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},s.$utils=function(){return l},s.isValid=function(){return this.$d.toString()!==J},s.isSame=function(t,n){var e=v(t);return this.startOf(n)<=e&&e<=this.endOf(n)},s.isAfter=function(t,n){return v(t)<this.startOf(n)},s.isBefore=function(t,n){return this.endOf(n)<v(t)},s.$g=function(t,n,e){return l.u(t)?this[n]:this.set(e,t)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(t,n){var e=this,i=!!l.u(n)||n,o=l.p(t),f=function(Y,g){var A=l.w(e.$u?Date.UTC(e.$y,g,Y):new Date(e.$y,g,Y),e);return i?A:A.endOf(w)},m=function(Y,g){return l.w(e.toDate()[Y].apply(e.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(g)),e)},p=this.$W,_=this.$M,D=this.$D,W="set"+(this.$u?"UTC":"");switch(o){case S:return i?f(1,0):f(31,11);case y:return i?f(1,_):f(0,_+1);case U:var N=this.$locale().weekStart||0,V=(p<N?p+7:p)-N;return f(i?D-V:D+(6-V),_);case w:case L:return m(W+"Hours",0);case I:return m(W+"Minutes",1);case O:return m(W+"Seconds",2);case k:return m(W+"Milliseconds",3);default:return this.clone()}},s.endOf=function(t){return this.startOf(t,!1)},s.$set=function(t,n){var e,i=l.p(t),o="set"+(this.$u?"UTC":""),f=(e={},e[w]=o+"Date",e[L]=o+"Date",e[y]=o+"Month",e[S]=o+"FullYear",e[I]=o+"Hours",e[O]=o+"Minutes",e[k]=o+"Seconds",e[H]=o+"Milliseconds",e)[i],m=i===w?this.$D+(n-this.$W):n;if(i===y||i===S){var p=this.clone().set(L,1);p.$d[f](m),p.init(),this.$d=p.set(L,Math.min(this.$D,p.daysInMonth())).$d}else f&&this.$d[f](m);return this.init(),this},s.set=function(t,n){return this.clone().$set(t,n)},s.get=function(t){return this[l.p(t)]()},s.add=function(t,n){var e,i=this;t=Number(t);var o=l.p(n),f=function(_){var D=v(i);return l.w(D.date(D.date()+Math.round(_*t)),i)};if(o===y)return this.set(y,this.$M+t);if(o===S)return this.set(S,this.$y+t);if(o===w)return f(1);if(o===U)return f(7);var m=(e={},e[O]=C,e[I]=x,e[k]=j,e)[o]||1,p=this.$d.getTime()+t*m;return l.w(p,this)},s.subtract=function(t,n){return this.add(-1*t,n)},s.format=function(t){var n=this,e=this.$locale();if(!this.isValid())return e.invalidDate||J;var i=t||"YYYY-MM-DDTHH:mm:ssZ",o=l.z(this),f=this.$H,m=this.$m,p=this.$M,_=e.weekdays,D=e.months,W=e.meridiem,N=function(g,A,Z,Q){return g&&(g[A]||g(n,i))||Z[A].slice(0,Q)},V=function(g){return l.s(f%12||12,g,"0")},Y=W||function(g,A,Z){var Q=g<12?"AM":"PM";return Z?Q.toLowerCase():Q};return i.replace(et,(function(g,A){return A||(function(Z){switch(Z){case"YY":return String(n.$y).slice(-2);case"YYYY":return l.s(n.$y,4,"0");case"M":return p+1;case"MM":return l.s(p+1,2,"0");case"MMM":return N(e.monthsShort,p,D,3);case"MMMM":return N(D,p);case"D":return n.$D;case"DD":return l.s(n.$D,2,"0");case"d":return String(n.$W);case"dd":return N(e.weekdaysMin,n.$W,_,2);case"ddd":return N(e.weekdaysShort,n.$W,_,3);case"dddd":return _[n.$W];case"H":return String(f);case"HH":return l.s(f,2,"0");case"h":return V(1);case"hh":return V(2);case"a":return Y(f,m,!0);case"A":return Y(f,m,!1);case"m":return String(m);case"mm":return l.s(m,2,"0");case"s":return String(n.$s);case"ss":return l.s(n.$s,2,"0");case"SSS":return l.s(n.$ms,3,"0");case"Z":return o}return null})(g)||o.replace(":","")}))},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(t,n,e){var i,o=this,f=l.p(n),m=v(t),p=(m.utcOffset()-this.utcOffset())*C,_=this-m,D=function(){return l.m(o,m)};switch(f){case S:i=D()/12;break;case y:i=D();break;case R:i=D()/3;break;case U:i=(_-p)/6048e5;break;case w:i=(_-p)/864e5;break;case I:i=_/x;break;case O:i=_/C;break;case k:i=_/j;break;default:i=_}return e?i:l.a(i)},s.daysInMonth=function(){return this.endOf(y).$D},s.$locale=function(){return d[this.$L]},s.locale=function(t,n){if(!t)return this.$L;var e=this.clone(),i=u(t,n,!0);return i&&(e.$L=i),e},s.clone=function(){return l.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},r})(),ct=q.prototype;return v.prototype=ct,[["$ms",H],["$s",k],["$m",O],["$H",I],["$W",w],["$M",y],["$y",S],["$D",L]].forEach((function(r){ct[r[1]]=function(s){return this.$g(s,r[0],r[1])}})),v.extend=function(r,s){return r.$i||(r(s,q,v),r.$i=!0),v},v.locale=u,v.isDayjs=F,v.unix=function(r){return v(1e3*r)},v.en=d[a],v.Ls=d,v.p={},v}))})(X)),X.exports}var Lt=Ht();const At=xt(Lt);_t(mt);const Pt={class:"page"},jt={key:0,class:"plots"},Nt={class:"plot-header"},Yt={class:"plot-title"},Et={key:0},Bt={key:1},Ut={key:2},Rt={class:"plot-body"},Wt={class:"row"},zt={class:"value"},Ft={key:0},Vt={key:1},Zt={key:0,class:"row"},Jt={class:"value"},qt={key:1,class:"row"},Qt={class:"value"},Gt={class:"plot-actions"},Kt={key:1,class:"empty"},Xt={class:"plant-popup-inner"},te={class:"plant-popup-header"},ee={class:"plant-sheet"},se={class:"plant-sheet-grid"},ne=["onClick"],ae={class:"herb-card-main"},re={class:"herb-info"},ie={class:"herb-name"},oe={class:"herb-meta"},ue=gt({__name:"cave",setup(T){const lt=Mt(),j=E(!1),C=E([]),x=E(!1),H=E(!1),k=E(null),O=E(!1),I=E(null),w=kt.EMPTY,U=wt(()=>Ot.map(h=>{const a=It(h);let d="flower-o";return(a.id===ut.SPIRIT_FRUIT||a.id===ut.SPIRIT_ORCHID)&&(d="fire-o"),a.id===ut.SPIRIT_LOTUS&&(d="diamond-o"),{id:a.id,name:a.name,matureMinutes:Math.max(1,Math.round(a.matureSeconds/60)),icon:d,rarity:a.rarity,rarityLabel:a.rarityLabel}})),y=h=>h?At(h).format("HH:mm:ss"):"-",R=h=>{if(h.code==="AUTH_UNAUTHORIZED"){P(h.message),lt.push("/login");return}P(h.message)},S=async()=>{if(!j.value){j.value=!0;try{const{data:h,error:a}=await nt("/api/cave/status",{method:"GET"},"$XZ6wQ-2SB6");if(a.value)throw a.value;if(!h.value)throw new Error("加载洞府信息失败");if(!h.value.success){R(h.value);return}C.value=h.value.data.plots}catch(h){const a=h?.message||"加载洞府信息失败";P(a)}finally{j.value=!1}}},L=h=>{k.value=h,x.value=!0},J=()=>{x.value=!1},tt=async h=>{if(H.value)return;const a=k.value;if(a===null){x.value=!1;return}H.value=!0;try{const{data:d,error:b}=await nt("/api/cave/plant",{method:"POST",body:{slotIndex:a,herbId:h}},"$6QHMosjBWc");if(b.value)throw b.value;if(!d.value)throw new Error("种植失败");if(!d.value.success){R(d.value);return}P("种植成功"),x.value=!1,await S()}catch(d){const b=d?.message||"种植失败，请稍后重试";P(b)}finally{H.value=!1,k.value=null}},et=async h=>{if(!O.value){O.value=!0,I.value=h;try{const{data:a,error:d}=await nt("/api/cave/harvest",{method:"POST",body:{slotIndex:h}},"$kMwzh6bDLa");if(d.value)throw d.value;if(!a.value)throw new Error("收获失败");if(!a.value.success){R(a.value);return}const b=a.value.data.harvest.herbName;b?P(`收获到 ${b}`):P("收获成功"),await S()}catch(a){const d=a?.message||"收获失败，请稍后重试";P(d)}finally{O.value=!1,I.value=null}}},{pause:st,resume:z}=Ct(()=>{S()},5e3,{immediate:!1});return St(async()=>{await S(),z()}),bt(()=>{st()}),(h,a)=>{const d=$t,b=yt,F=pt;return $(),M("div",Pt,[a[10]||(a[10]=c("div",{class:"header"},[c("h1",{class:"title"},"洞府·药园"),c("p",{class:"subtitle"},"一方小院，静候灵草成熟")],-1)),C.value.length>0?($(),M("div",jt,[($(!0),M(dt,null,ft(C.value,u=>($(),M("div",{key:u.id,class:"plot-card"},[c("div",Nt,[c("div",Yt," 第 "+B(u.slotIndex+1)+" 块灵田 ",1),c("div",{class:rt(["plot-status",{"plot-status-empty":u.status===K(w),"plot-status-growing":u.status!==K(w)&&!u.isMature,"plot-status-ready":u.isMature}])},[u.status===K(w)?($(),M("span",Et,"空置")):u.isMature?($(),M("span",Bt,"可收获")):($(),M("span",Ut,"生长中"))],2)]),c("div",Rt,[c("div",Wt,[a[1]||(a[1]=c("span",{class:"label"},"灵草",-1)),c("span",zt,[u.herbName?($(),M("span",Ft,B(u.herbName),1)):($(),M("span",Vt,"尚未种植"))])]),u.plantedAt?($(),M("div",Zt,[a[2]||(a[2]=c("span",{class:"label"},"种下时间",-1)),c("span",Jt,B(y(u.plantedAt)),1)])):ht("",!0),u.matureAt?($(),M("div",qt,[a[3]||(a[3]=c("span",{class:"label"},"预计成熟",-1)),c("span",Qt,B(y(u.matureAt)),1)])):ht("",!0)]),c("div",Gt,[u.status===K(w)?($(),it(d,{key:0,size:"small",type:"primary",block:"",loading:k.value===u.slotIndex&&H.value,onClick:v=>L(u.slotIndex)},{default:G(()=>[...a[4]||(a[4]=[ot(" 种植灵草 ",-1)])]),_:1},8,["loading","onClick"])):u.isMature?($(),it(d,{key:1,size:"small",type:"success",block:"",loading:I.value===u.slotIndex&&O.value,onClick:v=>et(u.slotIndex)},{default:G(()=>[...a[5]||(a[5]=[ot(" 收获灵草 ",-1)])]),_:1},8,["loading","onClick"])):($(),it(d,{key:2,size:"small",type:"default",block:"",disabled:""},{default:G(()=>[...a[6]||(a[6]=[ot(" 正在生长 ",-1)])]),_:1}))])]))),128))])):($(),M("div",Kt,[...a[7]||(a[7]=[c("p",null,"暂未查询到洞府信息，请尝试刷新或重新登录。",-1)])])),at(F,{show:x.value,"onUpdate:show":a[0]||(a[0]=u=>x.value=u),position:"center",round:"",class:"plant-popup"},{default:G(()=>[c("div",Xt,[c("div",te,[a[8]||(a[8]=c("div",{class:"plant-popup-title"}," 选择要种下的灵草 ",-1)),at(b,{name:"cross",class:"plant-popup-close",onClick:J})]),a[9]||(a[9]=c("div",{class:"plant-popup-subtitle"}," 不同品阶的灵草成熟时间与价值各不相同 ",-1)),c("div",ee,[c("div",se,[($(!0),M(dt,null,ft(U.value,u=>($(),M("div",{key:u.id,class:rt(["herb-card",[`herb-card-${u.rarity}`]]),onClick:v=>tt(u.id)},[c("div",ae,[at(b,{name:u.icon,class:"herb-icon"},null,8,["name"]),c("div",re,[c("div",ie,B(u.name),1),c("div",oe," 约 "+B(u.matureMinutes)+" 分钟成熟 ",1)])]),c("div",{class:rt(["herb-tag",`herb-tag-${u.rarity}`])},B(u.rarityLabel),3)],10,ne))),128))])])])]),_:1},8,["show"])])}}}),he=Dt(ue,[["__scopeId","data-v-8149f679"]]);export{he as default};
