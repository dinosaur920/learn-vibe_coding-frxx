{"version":3,"file":"index-By0J7HVx.js","sources":["../../../../node_modules/vant/es/progress/Progress.mjs","../../../../pages/index.vue"],"sourcesContent":["import { computed, defineComponent, createVNode as _createVNode } from \"vue\";\nimport { addUnit, truthProp, numericProp, createNamespace } from \"../utils/index.mjs\";\nconst [name, bem] = createNamespace(\"progress\");\nconst progressProps = {\n  color: String,\n  inactive: Boolean,\n  pivotText: String,\n  textColor: String,\n  showPivot: truthProp,\n  pivotColor: String,\n  trackColor: String,\n  strokeWidth: numericProp,\n  percentage: {\n    type: numericProp,\n    default: 0,\n    validator: (value) => +value >= 0 && +value <= 100\n  }\n};\nvar stdin_default = defineComponent({\n  name,\n  props: progressProps,\n  setup(props) {\n    const background = computed(() => props.inactive ? void 0 : props.color);\n    const format = (rate) => Math.min(Math.max(+rate, 0), 100);\n    const renderPivot = () => {\n      const {\n        textColor,\n        pivotText,\n        pivotColor,\n        percentage\n      } = props;\n      const safePercentage = format(percentage);\n      const text = pivotText != null ? pivotText : `${percentage}%`;\n      if (props.showPivot && text) {\n        const style = {\n          color: textColor,\n          left: `${safePercentage}%`,\n          transform: `translate(-${safePercentage}%,-50%)`,\n          background: pivotColor || background.value\n        };\n        return _createVNode(\"span\", {\n          \"style\": style,\n          \"class\": bem(\"pivot\", {\n            inactive: props.inactive\n          })\n        }, [text]);\n      }\n    };\n    return () => {\n      const {\n        trackColor,\n        percentage,\n        strokeWidth\n      } = props;\n      const safePercentage = format(percentage);\n      const rootStyle = {\n        background: trackColor,\n        height: addUnit(strokeWidth)\n      };\n      const portionStyle = {\n        width: `${safePercentage}%`,\n        background: background.value\n      };\n      return _createVNode(\"div\", {\n        \"class\": bem(),\n        \"style\": rootStyle\n      }, [_createVNode(\"span\", {\n        \"class\": bem(\"portion\", {\n          inactive: props.inactive\n        }),\n        \"style\": portionStyle\n      }, null), renderPivot()]);\n    };\n  }\n});\nexport {\n  stdin_default as default,\n  progressProps\n};\n","<template>\n  <div class=\"page\">\n    <div class=\"header\">\n      <h1 class=\"title\">凡人修仙传·掌上仙途</h1>\n      <p class=\"subtitle\">静坐吐纳，修炼真元</p>\n    </div>\n\n    <div v-if=\"playerInfo\" class=\"card\">\n      <div class=\"row\">\n        <span class=\"label\">道号</span>\n        <span class=\"value\">{{ playerInfo.username }}</span>\n      </div>\n      <div class=\"row\">\n        <span class=\"label\">境界</span>\n        <span class=\"value\">{{ playerInfo.realmLabel }}</span>\n      </div>\n      <div class=\"row\">\n        <span class=\"label\">灵根</span>\n        <span class=\"value\">{{ playerInfo.spiritRootLabel }}</span>\n      </div>\n    </div>\n\n    <div v-if=\"playerInfo\" class=\"card\">\n      <div class=\"row\">\n        <span class=\"label\">当前修为</span>\n        <span class=\"value\">\n          {{ playerInfo.cultivation }} / {{ playerInfo.maxCultivation }}\n        </span>\n      </div>\n      <van-progress :percentage=\"progressPercent\" :show-pivot=\"false\" />\n      <div class=\"row\">\n        <span class=\"label\">修炼速度</span>\n        <span class=\"value\">\n          {{ cultivationSpeed.toFixed(2) }} / 秒\n        </span>\n      </div>\n    </div>\n\n    <div v-if=\"playerInfo\" class=\"actions\">\n      <van-button type=\"primary\" round block :loading=\"cultivating\" @click=\"onCultivateOnce\">\n        打坐修炼\n      </van-button>\n      <van-button type=\"success\" round block :loading=\"breakingThrough\" :disabled=\"!canBreakthrough\"\n        @click=\"onBreakthrough\">\n        突破\n      </van-button>\n      <van-button type=\"default\" round block @click=\"toggleAutoCultivate\">\n        {{ autoCultivate ? \"暂停挂机\" : \"开始挂机\" }}\n      </van-button>\n      <p class=\"hint\">\n        挂机开启时，每秒自动结算一次修为，离线时间也会在下次结算时一次补齐。\n      </p>\n    </div>\n\n    <div v-else class=\"empty\">\n      <p>尚未登录，请先前往登录页。</p>\n      <van-button type=\"primary\" round block :to=\"{ path: '/login' }\">\n        去登录\n      </van-button>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, onBeforeUnmount, onMounted, ref } from \"vue\"\nimport { useRouter } from \"vue-router\"\nimport { showToast } from \"vant\"\nimport { useIntervalFn } from \"@vueuse/core\"\nimport { usePlayerStore } from \"~/stores/player\"\nimport { calculateCultivationGainPerSecond, Realm, SpiritRoot } from \"~/utils/gameConstants\"\n\nconst router = useRouter()\nconst playerStore = usePlayerStore()\n\nconst cultivating = ref(false)\nconst autoCultivate = ref(true)\nconst breakingThrough = ref(false)\n\nconst playerInfo = computed(() => playerStore.playerInfo)\n\nconst progressPercent = computed(() => {\n  if (!playerInfo.value || playerInfo.value.maxCultivation <= 0) {\n    return 0\n  }\n  const value = (playerInfo.value.cultivation / playerInfo.value.maxCultivation) * 100\n  if (value < 0) {\n    return 0\n  }\n  if (value > 100) {\n    return 100\n  }\n  return Math.floor(value)\n})\n\nconst cultivationSpeed = computed(() => {\n  if (!playerInfo.value) {\n    return 0\n  }\n  const realm = playerInfo.value.realm as Realm\n  const spiritRoot = playerInfo.value.spiritRoot as SpiritRoot\n  return calculateCultivationGainPerSecond(spiritRoot, realm)\n})\n\nconst canBreakthrough = computed(() => {\n  if (!playerInfo.value) {\n    return false\n  }\n  if (playerInfo.value.maxCultivation <= 0) {\n    return false\n  }\n  return playerInfo.value.cultivation >= playerInfo.value.maxCultivation\n})\n\nconst runCultivate = async () => {\n  if (!playerInfo.value) {\n    return\n  }\n  if (typeof (playerStore as any).cultivate !== \"function\") {\n    return\n  }\n  try {\n    await playerStore.cultivate()\n  } catch (error: any) {\n    const message = error?.message || \"修炼失败，请稍后重试\"\n    showToast(message)\n  }\n}\n\nconst onCultivateOnce = async () => {\n  if (!playerInfo.value) {\n    showToast(\"请先登录\")\n    router.push(\"/login\")\n    return\n  }\n  if (cultivating.value) {\n    return\n  }\n  cultivating.value = true\n  try {\n    await runCultivate()\n  } finally {\n    cultivating.value = false\n  }\n}\n\nconst onBreakthrough = async () => {\n  if (!playerInfo.value) {\n    showToast(\"请先登录\")\n    router.push(\"/login\")\n    return\n  }\n  if (!canBreakthrough.value) {\n    showToast(\"当前修为尚未圆满\")\n    return\n  }\n  if (breakingThrough.value) {\n    return\n  }\n  if (typeof (playerStore as any).breakthrough !== \"function\") {\n    return\n  }\n  breakingThrough.value = true\n  try {\n    await playerStore.breakthrough()\n    showToast(\"突破成功！\")\n  } catch (error: any) {\n    const message = error?.message || \"突破失败，请稍后重试\"\n    showToast(message)\n  } finally {\n    breakingThrough.value = false\n  }\n}\n\nconst toggleAutoCultivate = () => {\n  autoCultivate.value = !autoCultivate.value\n}\n\nconst { pause, resume } = useIntervalFn(\n  () => {\n    if (!autoCultivate.value) {\n      return\n    }\n    if (!playerInfo.value) {\n      return\n    }\n    if (typeof (playerStore as any).cultivate !== \"function\") {\n      return\n    }\n    playerStore.cultivate().catch(() => { })\n  },\n  1000,\n  {\n    immediate: false\n  }\n)\n\nonMounted(async () => {\n  try {\n    if (!playerInfo.value) {\n      await playerStore.fetchProfile()\n    }\n    if (!playerInfo.value) {\n      router.push(\"/login\")\n      return\n    }\n    resume()\n  } catch {\n    router.push(\"/login\")\n  }\n})\n\nonBeforeUnmount(() => {\n  pause()\n})\n</script>\n\n<style scoped>\n.page {\n  min-height: 100vh;\n  padding: 24px 16px 32px;\n  box-sizing: border-box;\n  background: #0b1020;\n  color: #f5f5f5;\n}\n\n.header {\n  text-align: center;\n  margin-bottom: 16px;\n}\n\n.title {\n  margin: 0 0 4px;\n  font-size: 20px;\n}\n\n.subtitle {\n  margin: 0;\n  font-size: 13px;\n  color: #c9c9c9;\n}\n\n.card {\n  margin-top: 12px;\n  padding: 12px;\n  border-radius: 8px;\n  background: rgba(15, 22, 40, 0.9);\n}\n\n.row {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  font-size: 14px;\n  margin-bottom: 6px;\n}\n\n.row:last-child {\n  margin-bottom: 0;\n}\n\n.label {\n  color: #9fa3b0;\n}\n\n.value {\n  color: #f5f5f5;\n}\n\n.actions {\n  margin-top: 16px;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.hint {\n  margin: 0;\n  font-size: 12px;\n  color: #8f9bb3;\n}\n\n.empty {\n  margin-top: 32px;\n}\n</style>\n"],"names":["_createVNode","_ssrRenderAttrs","_mergeProps","_ssrInterpolate"],"mappings":"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","x_google_ignoreList":[0]}